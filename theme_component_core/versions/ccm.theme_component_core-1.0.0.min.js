(()=>{const e={name:"theme_component_core",version:[1,0,0],ccm:"https://ccmjs.github.io/ccm/versions/ccm-25.5.3.min.js",config:{html:["ccm.load","https://modularcms.github.io/modularcms-components/theme_component_core/resources/html/template.html"],hash:["ccm.load","https://ccmjs.github.io/akless-components/modules/md5.mjs"],helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-5.1.0.mjs"],data_controller:["ccm.instance","https://modularcms.github.io/modularcms-components/data_controller/versions/ccm.data_controller-1.0.0.min.js"]},Instance:function(){let e;this.ready=(async()=>{e=Object.assign({},this.ccm.helper,this.helper)}),this.start=(async()=>{});let t={},n={},i={};this.initContent=(async(t=this.parent.html.main,n={},i={})=>{const o=this.parent.element,a=this.parent.zoneItem,s=this.parent.edit,r=this.parent.parentZoneName;e.setContent(o,e.html(t,n)),e.append(o,e.html(this.html.style,{})),s&&e.append(o,e.html(this.html.editStyle,{}));for(let t in i)e.setContent(o.querySelector("#"+t),i[t]);await this.updateContent(),s&&"themeDefinition"==a.type&&["block","contentComponent"].indexOf(a.data.themeDefinitionType)>=0&&this.addEditFocusHandling(o,r)}),this.updateContent=(async()=>{const o=this.parent.element,a=this.parent.zoneItem,s=this.parent.contentZones||{},r=this.parent.edit;for(let t in s){const l=s[t],d=o.querySelector('.content-zone[data-content-zone-name="'+t+'"]');if(void 0===i[t]&&(n[t]=[],i[t]=[]),d){let o=0;r&&d.addEventListener("drop",e=>e.preventDefault());let s=[];for(let e of l){let a=null;"themeDefinition"==e.type?a=await this.getThemeDefinitionElement(t,e,o):"ccmComponent"==e.type?(console.log(e),console.log("updateContent:ccmComponent",t,JSON.stringify(e),o),a=await this.getCcmComponentElement(t,e,o)):this.checkIfZoneItemAtIndexIsEqual(t,e,o)?a=i[t][o]:"header"==e.type?a=this.getHeaderElement(t,e):"paragraph"==e.type?a=this.getParagraphElement(t,e):"list"==e.type?a=this.getListElement(t,e):"image"==e.type&&(a=this.getImageElement(t,e)),i[t][o]=a,void 0!==a.ccmInstance&&(n[t][o]=a.ccmInstance),null!=a&&s.push(a),o++}d.innerHTML="";for(let n of s)e.append(d,n),r&&n.parentNode.insertBefore(this.getAddContentBlockTypeElement(n,t),n.nextSibling,t);if(r&&"themeDefinition"==a.type&&"layout"==a.data.themeDefinitionType){const n=e.html(this.html.addBlock,{});e.append(d,n),r&&n.addEventListener("click",()=>{this.addItem(t)})}}}t=s}),this.addEditFocusHandling=((t,n)=>{this.parent.parent.element.addEventListener("click",e=>{if(e.target!=this.parent.root&&t){t.classList.remove("edit-focus");let e=t.querySelector(".content-component-edit-focus");null!=e&&e.classList.remove("content-component-edit-focus")}}),this.parent.root.addEventListener("click",()=>{t.classList.add("edit-focus")});let i=e.html(this.html.editThemeDefinition,{});e.append(t,i);let o=e.html(this.html.addThemeDefinitionAfter,{});e.append(t,o),o.addEventListener("click",()=>{this.parent.parent.core.addItem(n,this.parent.root.parentNode),this.parent.element.classList.remove("edit-focus")}),i.querySelector('img[data-action="remove"').addEventListener("click",()=>{if(confirm("Do you really want to remove this block?")){const e=new CustomEvent("pageRendererRemoveBlock",{detail:{}});window.dispatchEvent(e),this.parent.parent.core.removeZoneItem(this.parent.root.parentNode,n)}});const a=i.querySelector('img[data-action="config"');let s=this.parent;a.addEventListener("click",()=>{const t=new CustomEvent("pageRendererEditBlockConfig",{detail:{zoneItem:this.parent.zoneItem,updateConfig:async t=>{s=await(async t=>{let i={};return Object.assign(i,void 0===s.zoneItem.data.config?{}:e.clone(s.zoneItem.data.config),t),(await s.parent.core.updateThemeDefinitionElementConfig(s.parent.element.querySelector('.content-zone[data-content-zone-name="'+n+'"]'),s.root.parentNode,s.zoneItem,n,s,i)).ccmInstance})(t)}}});window.dispatchEvent(t)})}),this.checkIfZoneItemAtIndexIsEqual=((n,i,o)=>{if(void 0!==t[n]&&void 0!==t[n][o]){let a=t=>{let n=e.clone(t);return delete n.contentZones,n},s=e=>{const t=JSON.stringify(e);return this.hash.md5(t)};const r=a(t[n][o]),l=a(i);return s(r)==s(l)}return!1}),this.addItem=((e,t=null)=>{const n=new CustomEvent("pageRendererAddBlock",{detail:{addThemeDefinitionFunction:async n=>{this.createBlock(this.parent.element.querySelector('.content-zone[data-content-zone-name="'+e+'"]'),t,e,n)}}});window.dispatchEvent(n)}),this.placeCaretAtEnd=(e=>{if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(void 0!==document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}),this.addContentPasteHandling=((e,t,n=!0)=>{e.addEventListener("paste",i=>{i.preventDefault();let o=(i.originalEvent||i).clipboardData.getData("text/plain").split("\n");n&&document.execCommand("insertText",!1,o[0]);let a=null;if(n&&o.length>1){const t=this.parent.element.parentNode.getSelection(),n=this.splitNode(t,e).next.extractContents();(a=document.createElement("div")).appendChild(n)}let s=e;for(let i=n?1:0;i<o.length-1;i++)s=this.addParagraphAfter(e.parentNode,s,t,o[i].replace(/  /g,"&nbsp; "));a&&(s.innerHTML+=a.innerHTML)})}),this.getThemeDefinition=(async e=>{const t=this.parent.page,n=this.parent.websiteKey;if(void 0===window.modularcms&&(window.modularcms={}),void 0===window.modularcms._themeDefinitions&&(window.modularcms._themeDefinitions={}),void 0===window.modularcms._themeDefinitions[t.themeKey]&&(window.modularcms._themeDefinitions[t.themeKey]={}),0==Object.keys(window.modularcms._themeDefinitions[t.themeKey]).length){let e=await this.data_controller.getAllThemeDefinitionsOfTheme(n,t.themeKey);for(let n of e)window.modularcms._themeDefinitions[t.themeKey][n.themeDefinitionKey]=n}return void 0===window.modularcms._themeDefinitions[t.themeKey][e]&&(window.modularcms._themeDefinitions[t.themeKey][e]=await this.data_controller.getThemeDefinition(n,t.themeKey,e)),window.modularcms._themeDefinitions[t.themeKey][e]}),this.getThemeDefinitionComponent=(async e=>{const t=this.parent.page;if(void 0===window.modularcms._themeDefinitionComponents&&(window.modularcms._themeDefinitionComponents={}),void 0===window.modularcms._themeDefinitionComponents[t.themeKey]&&(window.modularcms._themeDefinitionComponents[t.themeKey]={}),void 0===window.modularcms._themeDefinitionComponents[t.themeKey][e]){const n=await this.getThemeDefinition(e);window.modularcms._themeDefinitionComponents[t.themeKey][e]=await this.ccm.component(n.ccmComponent.url,n.ccmComponent.config)}return window.modularcms._themeDefinitionComponents[t.themeKey][e]}),this.getNewThemeDefinitionElement=(async(e,t,n)=>{this.parent.websiteKey,this.parent.page;const i=await this.getThemeDefinition(t);return await this.getThemeDefinitionElement(e,{type:"themeDefinition",data:{themeDefinitionKey:t,themeDefinitionType:i.type,ignore:{config:{}}}},n,!0)}),this.getThemeDefinitionElement=(async(t,i,o,a=!1)=>{const s=this.parent.websiteKey,r=this.parent.page,l=this.parent.edit,d=await this.getThemeDefinition(i.data.themeDefinitionKey);if(d){let c={};Object.assign(c,e.clone(i.data.ignore.config),{parent:this.parent,zoneItem:i,contentZones:i.contentZones,websiteKey:s,page:r,edit:l,parentZoneName:t});const m=await this.getThemeDefinitionComponent(i.data.themeDefinitionKey);let p=null,h=document.createElement("div");if(a||!this.checkIfZoneItemAtIndexIsEqual(t,i,o)?p=await m.start(Object.assign(c,{root:h})):(p=n[t][o],Object.assign(p,c),e.append(h,p.root),p.updateChildren()),h.contentZoneItem=i,h.ccmInstance=p,h.themeDefinitionType=d.type,l&&"contentComponent"==i.data.themeDefinitionType){h.contentEditable="true",p.root.contentEditable="false",p.element.style.pointerEvents="none !important",p.root.classList.add("content-component"),h.addEventListener("click",()=>{h.focus()});let n=h;h.addEventListener("dblclick",()=>{h.classList.add("content-component-edit-focus");let o=async(o,a)=>{let s={};return Object.assign(s,void 0===i.data.ignore.config?{}:e.clone(i.data.ignore.config),o),await this.updateThemeDefinitionElementConfig(n.parentNode,n,i,t,this.parent,s)};const a=new CustomEvent("pageRendererEditBlockConfig",{detail:{zoneItem:i,updateConfig:async(e,t)=>{n=await o(e)}}});window.dispatchEvent(a)}),this.addContentRemoveAndEnterHandling(h,t)}return h.getDataContent=(()=>({themeDefinitionKey:d.themeDefinitionKey,themeDefinitionType:d.type,ignore:{config:i.data.ignore.config}})),h.setAttribute("data-type",i.type),h}return null}),this.addThemeDefinitionAfter=(async(e,t,n,o)=>{let a=await this.getNewThemeDefinitionElement(n,o,i[n].indexOf(t)+1);return this.addContentZoneItemAfter(e,t,a,n,a.ccmInstance),"block"==a.themeDefinitionType&&a.ccmInstance.element.querySelectorAll(".content-zone").forEach(e=>{a.ccmInstance.core.addParagraphAfter(e,null,e.getAttribute("data-content-zone-name"))}),a.focus(),a}),this.createBlock=(async(e,t=null,n,i)=>{let o=this.parent.element.querySelector('.content-zone[data-content-zone-name="'+n+'"] .add-block');(await this.addThemeDefinitionAfter(e,t,n,i)).ccmInstance.element.classList.add("edit-focus"),null!=t&&(t.ccmInstance.element.classList.remove("edit-focus"),t.ccmInstance.element.querySelectorAll(".edit-focus").forEach(e=>e.classList.remove("edit-focus"))),e.insertBefore(o,null)}),this.getNewCcmComponentElement=(async(e,t,n,i)=>await this.getCcmComponentElement(e,{type:"ccmComponent",data:{url:t,ignore:{config:n}}},i)),this.getCcmComponentElement=(async(t,o,a)=>{let s=e.clone(o.data.ignore.config);const r=this.parent.edit;let l=null,d=document.createElement("div");e.append(d,e.loading()),console.log("ccmComponentConfig",s);let c=await this.ccm.store(s[1]);console.log("ccmComponentConfigStore",c);let m=await c.get(s[2]);return console.log("ccmComponentConfigGet",m),l=await this.ccm.start(o.data.url,Object.assign({},m,{root:d,parent:this.parent})),console.log("ccmComponentInstance",l),n[t][a]=l,r&&(d.contentEditable="true",l.root.contentEditable="false",l.element.style.pointerEvents="none !important",l.root.classList.add("content-component")),d.addEventListener("dblclick",()=>{d.classList.add("content-component-edit-focus");let e=()=>{d&&d.classList.remove("content-component-edit-focus"),this.parent.element.removeEventListener("click",e)};this.parent.element.addEventListener("click",e);let n=d,a=async e=>{o.data.ignore.config=e;let a=await this.getNewCcmComponentElement(t,o.data.url,o.data.ignore.config,i[t].indexOf(n));return this.addContentZoneItemAfter(n.parentNode,n,a,t,a.ccmInstance),this.removeZoneItem(n,t),a};const s=new CustomEvent("pageRendererEditCcmComponentConfig",{detail:{zoneItem:o,updateCcmComponent:async e=>{n=await a(e)}}});window.dispatchEvent(s)}),this.addContentRemoveAndEnterHandling(d,t),d.getDataContent=(()=>({url:o.data.url,ignore:{config:o.data.ignore.config}})),d.contentZoneItem=o,d.ccmInstance=l,d.setAttribute("data-type",o.type),d}),this.getHeaderElement=((e,t={type:"header",data:{text:"",level:2},contentZones:{}})=>{const n=this.parent.edit;let i=document.createElement("h"+t.data.level);return i.innerHTML=t.data.text,i.contentZoneItem=t,i.setAttribute("data-header-level",t.data.level),n&&(i.contentEditable="true",this.addContentEditing(i,e)),i.getDataContent=(()=>({text:i.innerHTML,level:i.tagName.substring(1)})),i.setAttribute("data-type",t.type),this.addContentPasteHandling(i,e),i}),this.addHeaderAfter=((e,t,n,i=2,o="")=>{let a=this.getHeaderElement(n,{contentZones:{},type:"header",data:{level:i,text:o}});this.addContentZoneItemAfter(e,t,a,n),a.focus()}),this.getParagraphElement=((e,t={type:"paragraph",data:{text:""},contentZones:{}})=>{const n=this.parent.edit;let i=document.createElement("p");return i.contentZoneItem=t,i.innerHTML=t.data.text,n&&(i.contentEditable="true",this.addContentEditing(i,e)),i.getDataContent=(()=>({text:i.innerHTML.replace(/<br\/>/g,"")})),this.addContentPasteHandling(i,e),i.setAttribute("data-type",t.type),i}),this.addParagraphAfter=((e,t,n,i="")=>{let o=this.getParagraphElement(n,{contentZones:{},type:"paragraph",data:{text:i}});return this.addContentZoneItemAfter(e,t,o,n),o.focus(),o}),this.addParagraphBefore=((e,t,n,i="")=>{let o=this.getParagraphElement(n,{contentZones:{},type:"paragraph",data:{text:i}});this.addContentZoneItemBefore(e,t,o,n),o.focus()}),this.getListElement=((t,n={type:"list",data:{style:"unordered",items:[""]},contentZones:{}})=>{const i=this.parent.edit;let o=document.createElement("ordered"==n.data.style?"ol":"ul");i&&(o.contentEditable="true",o.addEventListener("keypress",n=>{if("Enter"===n.key){let i=this.parent.element.parentNode.getSelection().getRangeAt(0).startContainer;3==i.nodeType&&(i=i.parentNode),o.querySelector("li:last-child")==i&&""==i.innerHTML&&(n.preventDefault(),e.remove(i),this.addParagraphAfter(o.parentNode,o,t),0==o.childElementCount&&this.removeZoneItem(o,t))}}),o.addEventListener("change",t=>{let n=this.parent.element.parentNode.getSelection().getRangeAt(0).startContainer;3==n.nodeType&&(n=n.parentNode),n.querySelectorAll("br").forEach(t=>e.remove(t))}),o.addEventListener("keyup",n=>{let i=this.parent.element.parentNode.getSelection().getRangeAt(0).startContainer;3==i.nodeType&&(i=i.parentNode),i.querySelectorAll("br").forEach(t=>e.remove(t)),"Backspace"!=n.key&&"Delete"!=n.key||""!=i.innerHTML&&""!=i.innerHTML||0==o.childElementCount&&("Backspace"==n.key&&o.previousSibling&&o.previousSibling.previousSibling?this.placeCaretAtEnd(o.previousSibling.previousSibling):"Delete"==n.key&&o.nextSibling&&o.nextSibling.nextSibling?o.nextSibling.nextSibling.focus():this.addParagraphAfter(o.parentNode,o,t),this.removeZoneItem(o,t))})),o.setAttribute("data-list-style",n.data.style);for(let e of n.data.items){let t=e=>{let t=document.createElement("li");return t.innerHTML=e,t};o.appendChild(t(e))}return o.setAttribute("data-type",n.type),o.contentZoneItem=n,i&&this.addContentEditingFormat(o,t),o.getDataContent=(()=>{o.querySelectorAll("br").forEach(t=>e.remove(t));let t=[];return o.querySelectorAll("li").forEach(e=>t.push(e.innerHTML)),{style:"ol"==o.tagName?"ordered":"unordered",items:t}}),this.addContentPasteHandling(o,t),o}),this.getNewImageElement=((e,t)=>this.getImageElement(e,{type:"image",data:{file:{url:t},caption:null},contentZones:{}})),this.getImageElement=((e,t={type:"image",data:{file:{url:null},caption:null},contentZones:{}})=>{const n=this.parent.edit;let i=document.createElement("div");i.classList.add("image-wrapper"),n&&(i.contentEditable="true"),this.addContentRemoveAndEnterHandling(i,e);let o=document.createElement("img"),a=null;return o.src=t.data.file.url,o.loading="lazy",t.data.caption&&((a=document.createElement("div")).classList.add("image-caption"),a.innerHTML=t.data.caption),n&&o.addEventListener("click",()=>{this.placeCaretAtEnd(i)}),i.appendChild(o),a&&i.appendChild(a),i.getDataContent=(()=>({file:{url:o.src},caption:a?a.innerHTML:null})),this.addContentPasteHandling(i,e,!1),i.setAttribute("data-type",t.type),i.contentZoneItem=t,i}),this.updateThemeDefinitionElementConfig=(async(e,t,n,o,a,s)=>{n.data.config=s,n.contentZones=a.core.getContentZones();let r=await this.getThemeDefinitionElement(o,n,i[o].indexOf(t));return this.addContentZoneItemAfter(e,t,r,o,r.ccmInstance),"block"==r.themeDefinitionType&&r.ccmInstance.element.querySelectorAll(".content-zone").forEach(e=>{let t=e.getAttribute("data-content-zone-name");0===r.ccmInstance.core.getContentZoneElementCount(t)&&r.ccmInstance.core.addParagraphAfter(e,null,t)}),this.removeZoneItem(t,o),r}),this.addContentZoneItemAfter=((e,t,o,a,s=null)=>{void 0===i[a]&&(i[a]=[],n[a]=[]);let r=null==t?-1:i[a].indexOf(t);r>=0?(i[a].splice(r+1,0,o),n[a].splice(r+1,0,s)):(i[a].push(o),n[a].push(s)),e.insertBefore(o,null==t?null:t.nextSibling?t.nextSibling.nextSibling:null),e.insertBefore(this.getAddContentBlockTypeElement(o,a),o.nextSibling)}),this.addContentZoneItemBefore=((e,t,o,a,s=null)=>{void 0===i[a]&&(i[a]=[],n[a]=[]);let r=null==t?-1:i[a].indexOf(t);r>=0?(i[a].splice(r,0,o),n[a].splice(r,0,s)):(i[a].splice(0,0,o),n[a].splice(0,0,s)),e.insertBefore(o,null==t?null:t),e.insertBefore(this.getAddContentBlockTypeElement(o,a),o.nextSibling)}),this.removeZoneItem=((t,o)=>{let a=i[o].indexOf(t);a>=0?(i[o].splice(a,1),n[o].splice(a,1),e.remove(t.nextSibling),e.remove(t)):console.error("Could not remove zone item. Please check zone management implementation!")}),this.addContentEditing=((t,n)=>{t.addEventListener("keydown",i=>{const o=this.parent.element.parentNode.getSelection().getRangeAt(0);if("Enter"===i.key&&o.collapsed)if(i.preventDefault(),e.remove(t.querySelector("div:last-child:not(.define-content-block-type)")),e.remove(t.querySelector("br:nth-child(2)")),""!=t.innerHTML){const e=this.parent.element.parentNode.getSelection(),i=this.splitNode(e,t).next.extractContents(),o=document.createElement("div");o.appendChild(i),this.addParagraphAfter(t.parentNode,t,n,o.innerHTML)}else this.addParagraphAfter(t.parentNode,t,n)}),t.addEventListener("keydown",e=>{const i=this.parent.element.parentNode.getSelection().getRangeAt(0);if("Backspace"===e.key&&(i.collapsed&&0==i.startOffset||!i.collapsed&&0==i.start&&i.endOffset==i.text.length))if(t.previousSibling&&t.previousSibling.previousSibling){if(e.preventDefault(),"themeDefinition"!=t.previousSibling.previousSibling.getAttribute("data-type")&&"ccmComponent"!=t.previousSibling.previousSibling.getAttribute("data-type")){for(this.placeCaretAtEnd(t.previousSibling.previousSibling);t.childNodes.length>0;)t.previousSibling.previousSibling.appendChild(t.childNodes[0]);this.removeZoneItem(t,n)}}else""==t.innerHTML&&(this.addParagraphAfter(t.parentNode,t,n),this.removeZoneItem(t,n))}),this.addContentEditingFormat(t,n)}),this.splitNode=((e,t)=>{let n=e.getRangeAt(0),{firstChild:i,lastChild:o}=t,a=document.createRange();a.setStart(i,0),a.setEnd(n.startContainer,n.startOffset);let s=document.createRange();return s.setStart(n.endContainer,n.endOffset),s.setEnd(o,o.length),{previous:a,current:n,next:s}}),this.addContentEditingFormat=((t,n)=>{let i=()=>{t.removeEventListener("mouseup",i);const o=this.parent.element.parentNode.getSelection(),a=o.getRangeAt(0),s=a.getBoundingClientRect();let r=e=>null==e?0:1==e.nodeType?e.offsetTop+r(e.offsetParent)-e.scrollTop:r(e.offsetParent),l=e=>null==e?0:1==e.nodeType?e.offsetLeft+l(e.offsetParent)-e.scrollLeft:l(e.offsetParent);if(!a.collapsed||a.collapsed&&"header"==t.contentZoneItem.type){let d=e.html(this.html.editInlineTool,{}),c=s.left-l(this.parent.element)+s.width/2;c<0&&(c=0),d.style.left=c+"px",d.style.top=s.top-r(this.parent.element)+"px",e.append(this.parent.element,d),c<d.getBoundingClientRect().width/2&&(d.style.transform="translate(0, calc(-100% - 4px))",d.style.left="0"),["bold","italic","underline","strikeThrough","removeFormat","header"].forEach(e=>{d.querySelectorAll('img[data-action="'+e+'"]').forEach(i=>{(a.collapsed&&i.getAttribute("data-only-with-range")||i.getAttribute("data-type")&&JSON.parse(i.getAttribute("data-type")).indexOf(t.contentZoneItem.type)<0||i.getAttribute("data-type-not")&&i.getAttribute("data-type-not")==t.contentZoneItem.type)&&(i.style.display="none"),i.addEventListener("mouseup",()=>{"header"==e?(this.addHeaderAfter(t.parentNode,t,n,parseInt(i.getAttribute("data-header-level")),t.innerHTML),this.removeZoneItem(t,n),m()):(o.addRange(a),document.execCommand(e))})})});let m=()=>{e.remove(d)},p=()=>{window.removeEventListener("mousedown",p);let e=()=>{window.removeEventListener("mouseup",e),m(),1==this.parent.element.parentNode.getSelection().rangeCount&&a.collapsed&&"header"!=t.contentZoneItem.type&&i()};window.addEventListener("mouseup",e)};window.addEventListener("mousedown",p);let h=()=>{window.removeEventListener("selectstart",h),m()};window.addEventListener("selectstart",h);let g=()=>{window.removeEventListener("keydown",g),m()};window.addEventListener("keydown",g)}};t.addEventListener("selectstart",()=>{t.addEventListener("mouseup",i)})}),this.addContentRemoveAndEnterHandling=((t,n)=>{t.addEventListener("keydown",e=>{if("Backspace"==e.key||"Delete"==e.key){const i=this.parent.element.parentNode.getSelection().getRangeAt(0);e.preventDefault(),i.collapsed&&(0==i.startOffset&&"Delete"!=e.key?t.previousSibling&&t.previousSibling.previousSibling&&""==t.previousSibling.previousSibling.innerHTML&&this.removeZoneItem(t.previousSibling.previousSibling,n):("Delete"==e.key&&t.nextSibling&&t.nextSibling.nextSibling?t.nextSibling.nextSibling.focus():"Backspace"==e.key&&t.previousSibling&&t.previousSibling.previousSibling?this.placeCaretAtEnd(t.previousSibling.previousSibling):this.addParagraphAfter(t.parentNode,t,n),this.removeZoneItem(t,n)))}}),t.addEventListener("keypress",i=>{if("Enter"===i.key){const o=this.parent.element.parentNode.getSelection().getRangeAt(0);i.preventDefault(),e.remove(t.querySelector("div:last-child:not(.content-component)")),e.remove(t.querySelector("br")),o.collapsed&&(0==o.startOffset?this.addParagraphBefore(t.parentNode,t,n):this.addParagraphAfter(t.parentNode,t,n))}})}),this.getAddContentBlockTypeElement=((t,n)=>{const o=e.html(this.html.defineBlockType,{});let a=!1;t.addEventListener("focus",()=>{a=!0,t.classList.add("focus")});let s=!1;o.addEventListener("mousedown",()=>{s=!0}),o.addEventListener("mouseup",()=>{s=!1}),o.addEventListener("click",()=>{t.focus()}),t.addEventListener("focusout",()=>{a=!1,s||setTimeout(()=>t.classList.remove("focus"),100)});let r=e=>{let i=t.parentNode;this.addContentZoneItemAfter(i,t,e,n),this.removeZoneItem(t,n)};return o.querySelector('img[data-type="header"]').addEventListener("click",()=>{let e=this.getHeaderElement(n);r(e),e.focus()}),o.querySelector('img[data-type="list"]').addEventListener("click",()=>{let e=this.getListElement(n);r(e),e.focus()}),o.querySelector('img[data-type="image"]').addEventListener("click",()=>{cloudinary.createUploadWidget({cloudName:"dyhjqgkca",uploadPreset:"y6tm2ylf",sources:["local"],googleApiKey:"AIrFcR8hKiRo",multiple:!1,resourceType:"image",palette:{windowBorder:"#000000"}},(e,t)=>{if(!e&&t&&"success"===t.event){const e=t.info;let i=this.getNewImageElement(n,e.secure_url);r(i),this.placeCaretAtEnd(i)}}).open()}),o.querySelector('img[data-type="component"]').addEventListener("click",()=>{const e=new CustomEvent("pageRendererAddComponent",{detail:{addThemeDefinitionFunction:async e=>{r(await this.getNewThemeDefinitionElement(n,e,i[n].indexOf(t)))},addDmsContentComponentFunction:async(e,o)=>{r(await this.getNewCcmComponentElement(n,e,o,i[n].indexOf(t)))}}});window.dispatchEvent(e)}),o}),this.getContentZoneElementCount=(e=>void 0===i[e]?0:i[e].length),this.getContentZone=(e=>{let t=[];if(void 0!==i[e])for(let n of i[e]){let e=n.getAttribute("data-type"),i={type:e,data:n.getDataContent?n.getDataContent():{},contentZones:{}};"themeDefinition"==e&&n.ccmInstance.core&&n.ccmInstance.core.getContentZones&&(i.contentZones=n.ccmInstance.core.getContentZones()),t.push(i)}return t}),this.getContentZones=(()=>{let e={};for(let t in i)e[t]=this.getContentZone(t);return e})}};let t="ccm."+e.name+(e.version?"-"+e.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[t])return window.ccm.files[t]=e;(t=window.ccm&&window.ccm.components[e.name])&&t.ccm&&(e.ccm=t.ccm),"string"==typeof e.ccm&&(e.ccm={url:e.ccm});let n=(e.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];if(window.ccm&&window.ccm[n])window.ccm[n].component(e);else{var i=document.createElement("script");document.head.appendChild(i),e.ccm.integrity&&i.setAttribute("integrity",e.ccm.integrity),e.ccm.crossorigin&&i.setAttribute("crossorigin",e.ccm.crossorigin),i.onload=function(){window.ccm[n].component(e),document.head.removeChild(i)},i.src=e.ccm.url}})();